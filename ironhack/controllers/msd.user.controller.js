/*
 * Generated by: Mongoose Schema Designer
 * At: 17 december 2019
 * Author: Marc P. de Hoogh
 */
module.exports=(conn)=>{ // requires plugging in the connection to use for creating models
	const User=require('../models/msd.user.model.js')(conn?conn:require('mongoose'));
	return{
		create:function(req,res,next){
			// Step 1. if not all required fields are present, return appropriate error message.
			// Step 2. Create a new object with the received data (properties of reg.body));
			var userData={};
			if(req.body.hasOwnProperty('name'))if(req.body['name'])userData['name']=req.body['name'];
			if(req.body.hasOwnProperty('password'))if(req.body['password'])userData['password']=req.body['password'];
			const user=new User(userData);
			// Step 3. Save the newly created instance
			user.save().then(data=>{
				next(user,req,res,next); // can next passing in the return data
			}).catch(err=>{
				next(null,req,req,next);
			});
		},
		findOneByName:function(req,res,next){
			console.log("Login of ",req.body);
			User.findOne({'name':req.body.name}
			).then(user => {
				next(user,req,res,null);
			}).catch(err => {
				next(null,req,res,null);
			});
		}
	};
};